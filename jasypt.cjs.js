"use strict";var t=require("crypto"),e=require("assert"),n=require("node:buffer");function r(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,l(r.key),r)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function o(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return i(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}(t))||e){n&&(t=n);var r=0,s=function(){};return{s:s,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var h,o=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){l=!0,h=t},f:function(){try{o||null==n.return||n.return()}finally{if(l)throw h}}}}function l(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e);if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:e+""}var a,u,f,c,p,v,y,g,d,m,w,b,x,A,E,S={};function k(){if(a)return S;a=1;var t=Object.prototype.toString,e=function(e,n){return t.call(n)==="[object ".concat(e,"]")};return S.isEmpty=function(){var t,n=o(arguments);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(null==r)return!0;if(e("String",r)&&""===r.trim())return!0}}catch(t){n.e(t)}finally{n.f()}return!1},S.isType=e,S}function O(){if(y)return v;function t(e){var n=this;if(n instanceof t||(n=new t),n.tail=null,n.head=null,n.length=0,e&&"function"==typeof e.forEach)e.forEach((function(t){n.push(t)}));else if(arguments.length>0)for(var r=0,i=arguments.length;r<i;r++)n.push(arguments[r]);return n}function e(t,e,n){var r=e===t.head?new i(n,null,e,t):new i(n,e,e.next,t);return null===r.next&&(t.tail=r),null===r.prev&&(t.head=r),t.length++,r}function n(t,e){t.tail=new i(e,t.tail,null,t),t.head||(t.head=t.tail),t.length++}function r(t,e){t.head=new i(e,null,t.head,t),t.tail||(t.tail=t.head),t.length++}function i(t,e,n,r){if(!(this instanceof i))return new i(t,e,n,r);this.list=r,this.value=t,e?(e.next=this,this.prev=e):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}y=1,v=t,t.Node=i,t.create=t,t.prototype.removeNode=function(t){if(t.list!==this)throw new Error("removing node which does not belong to this list");var e=t.next,n=t.prev;return e&&(e.prev=n),n&&(n.next=e),t===this.head&&(this.head=e),t===this.tail&&(this.tail=n),t.list.length--,t.next=null,t.prev=null,t.list=null,e},t.prototype.unshiftNode=function(t){if(t!==this.head){t.list&&t.list.removeNode(t);var e=this.head;t.list=this,t.next=e,e&&(e.prev=t),this.head=t,this.tail||(this.tail=t),this.length++}},t.prototype.pushNode=function(t){if(t!==this.tail){t.list&&t.list.removeNode(t);var e=this.tail;t.list=this,t.prev=e,e&&(e.next=t),this.tail=t,this.head||(this.head=t),this.length++}},t.prototype.push=function(){for(var t=0,e=arguments.length;t<e;t++)n(this,arguments[t]);return this.length},t.prototype.unshift=function(){for(var t=0,e=arguments.length;t<e;t++)r(this,arguments[t]);return this.length},t.prototype.pop=function(){if(this.tail){var t=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,t}},t.prototype.shift=function(){if(this.head){var t=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,t}},t.prototype.forEach=function(t,e){e=e||this;for(var n=this.head,r=0;null!==n;r++)t.call(e,n.value,r,this),n=n.next},t.prototype.forEachReverse=function(t,e){e=e||this;for(var n=this.tail,r=this.length-1;null!==n;r--)t.call(e,n.value,r,this),n=n.prev},t.prototype.get=function(t){for(var e=0,n=this.head;null!==n&&e<t;e++)n=n.next;if(e===t&&null!==n)return n.value},t.prototype.getReverse=function(t){for(var e=0,n=this.tail;null!==n&&e<t;e++)n=n.prev;if(e===t&&null!==n)return n.value},t.prototype.map=function(e,n){n=n||this;for(var r=new t,i=this.head;null!==i;)r.push(e.call(n,i.value,this)),i=i.next;return r},t.prototype.mapReverse=function(e,n){n=n||this;for(var r=new t,i=this.tail;null!==i;)r.push(e.call(n,i.value,this)),i=i.prev;return r},t.prototype.reduce=function(t,e){var n,r=this.head;if(arguments.length>1)n=e;else{if(!this.head)throw new TypeError("Reduce of empty list with no initial value");r=this.head.next,n=this.head.value}for(var i=0;null!==r;i++)n=t(n,r.value,i),r=r.next;return n},t.prototype.reduceReverse=function(t,e){var n,r=this.tail;if(arguments.length>1)n=e;else{if(!this.tail)throw new TypeError("Reduce of empty list with no initial value");r=this.tail.prev,n=this.tail.value}for(var i=this.length-1;null!==r;i--)n=t(n,r.value,i),r=r.prev;return n},t.prototype.toArray=function(){for(var t=new Array(this.length),e=0,n=this.head;null!==n;e++)t[e]=n.value,n=n.next;return t},t.prototype.toArrayReverse=function(){for(var t=new Array(this.length),e=0,n=this.tail;null!==n;e++)t[e]=n.value,n=n.prev;return t},t.prototype.slice=function(e,n){(n=n||this.length)<0&&(n+=this.length),(e=e||0)<0&&(e+=this.length);var r=new t;if(n<e||n<0)return r;e<0&&(e=0),n>this.length&&(n=this.length);for(var i=0,s=this.head;null!==s&&i<e;i++)s=s.next;for(;null!==s&&i<n;i++,s=s.next)r.push(s.value);return r},t.prototype.sliceReverse=function(e,n){(n=n||this.length)<0&&(n+=this.length),(e=e||0)<0&&(e+=this.length);var r=new t;if(n<e||n<0)return r;e<0&&(e=0),n>this.length&&(n=this.length);for(var i=this.length,s=this.tail;null!==s&&i>n;i--)s=s.prev;for(;null!==s&&i>e;i--,s=s.prev)r.push(s.value);return r},t.prototype.splice=function(t,n,...r){t>this.length&&(t=this.length-1),t<0&&(t=this.length+t);for(var i=0,s=this.head;null!==s&&i<t;i++)s=s.next;var h=[];for(i=0;s&&i<n;i++)h.push(s.value),s=this.removeNode(s);null===s&&(s=this.tail),s!==this.head&&s!==this.tail&&(s=s.prev);for(i=0;i<r.length;i++)s=e(this,s,r[i]);return h},t.prototype.reverse=function(){for(var t=this.head,e=this.tail,n=t;null!==n;n=n.prev){var r=n.prev;n.prev=n.next,n.next=r}return this.head=e,this.tail=t,this};try{(p?c:(p=1,c=function(t){t.prototype[Symbol.iterator]=function*(){for(let t=this.head;t;t=t.next)yield t.value}}))(t)}catch(t){}return v}function T(){if(w)return m;w=1;var t=function(){if(d)return g;d=1;const t=O(),e=Symbol("max"),n=Symbol("length"),r=Symbol("lengthCalculator"),i=Symbol("allowStale"),s=Symbol("maxAge"),h=Symbol("dispose"),o=Symbol("noDisposeOnSet"),l=Symbol("lruList"),a=Symbol("cache"),u=Symbol("updateAgeOnGet"),f=()=>1,c=(t,e,n)=>{const r=t[a].get(e);if(r){const e=r.value;if(p(t,e)){if(y(t,r),!t[i])return}else n&&(t[u]&&(r.value.now=Date.now()),t[l].unshiftNode(r));return e.value}},p=(t,e)=>{if(!e||!e.maxAge&&!t[s])return!1;const n=Date.now()-e.now;return e.maxAge?n>e.maxAge:t[s]&&n>t[s]},v=t=>{if(t[n]>t[e])for(let r=t[l].tail;t[n]>t[e]&&null!==r;){const e=r.prev;y(t,r),r=e}},y=(t,e)=>{if(e){const r=e.value;t[h]&&t[h](r.key,r.value),t[n]-=r.length,t[a].delete(r.key),t[l].removeNode(e)}};class m{constructor(t,e,n,r,i){this.key=t,this.value=e,this.length=n,this.now=r,this.maxAge=i||0}}const w=(t,e,n,r)=>{let s=n.value;p(t,s)&&(y(t,n),t[i]||(s=void 0)),s&&e.call(r,s.value,s.key,t)};return g=class{constructor(t){if("number"==typeof t&&(t={max:t}),t||(t={}),t.max&&("number"!=typeof t.max||t.max<0))throw new TypeError("max must be a non-negative number");this[e]=t.max||1/0;const n=t.length||f;if(this[r]="function"!=typeof n?f:n,this[i]=t.stale||!1,t.maxAge&&"number"!=typeof t.maxAge)throw new TypeError("maxAge must be a number");this[s]=t.maxAge||0,this[h]=t.dispose,this[o]=t.noDisposeOnSet||!1,this[u]=t.updateAgeOnGet||!1,this.reset()}set max(t){if("number"!=typeof t||t<0)throw new TypeError("max must be a non-negative number");this[e]=t||1/0,v(this)}get max(){return this[e]}set allowStale(t){this[i]=!!t}get allowStale(){return this[i]}set maxAge(t){if("number"!=typeof t)throw new TypeError("maxAge must be a non-negative number");this[s]=t,v(this)}get maxAge(){return this[s]}set lengthCalculator(t){"function"!=typeof t&&(t=f),t!==this[r]&&(this[r]=t,this[n]=0,this[l].forEach((t=>{t.length=this[r](t.value,t.key),this[n]+=t.length}))),v(this)}get lengthCalculator(){return this[r]}get length(){return this[n]}get itemCount(){return this[l].length}rforEach(t,e){e=e||this;for(let n=this[l].tail;null!==n;){const r=n.prev;w(this,t,n,e),n=r}}forEach(t,e){e=e||this;for(let n=this[l].head;null!==n;){const r=n.next;w(this,t,n,e),n=r}}keys(){return this[l].toArray().map((t=>t.key))}values(){return this[l].toArray().map((t=>t.value))}reset(){this[h]&&this[l]&&this[l].length&&this[l].forEach((t=>this[h](t.key,t.value))),this[a]=new Map,this[l]=new t,this[n]=0}dump(){return this[l].map((t=>!p(this,t)&&{k:t.key,v:t.value,e:t.now+(t.maxAge||0)})).toArray().filter((t=>t))}dumpLru(){return this[l]}set(t,i,u){if((u=u||this[s])&&"number"!=typeof u)throw new TypeError("maxAge must be a number");const f=u?Date.now():0,c=this[r](i,t);if(this[a].has(t)){if(c>this[e])return y(this,this[a].get(t)),!1;const r=this[a].get(t).value;return this[h]&&(this[o]||this[h](t,r.value)),r.now=f,r.maxAge=u,r.value=i,this[n]+=c-r.length,r.length=c,this.get(t),v(this),!0}const p=new m(t,i,c,f,u);return p.length>this[e]?(this[h]&&this[h](t,i),!1):(this[n]+=p.length,this[l].unshift(p),this[a].set(t,this[l].head),v(this),!0)}has(t){if(!this[a].has(t))return!1;const e=this[a].get(t).value;return!p(this,e)}get(t){return c(this,t,!0)}peek(t){return c(this,t,!1)}pop(){const t=this[l].tail;return t?(y(this,t),t.value):null}del(t){y(this,this[a].get(t))}load(t){this.reset();const e=Date.now();for(let n=t.length-1;n>=0;n--){const r=t[n],i=r.e||0;if(0===i)this.set(r.k,r.v);else{const t=i-e;t>0&&this.set(r.k,r.v,t)}}}prune(){this[a].forEach(((t,e)=>c(this,e,!1)))}}}();return m=new t(2e3)}function j(){if(x)return b;x=1;var r=t,i=e,l=function(){if(f)return u;f=1;var r=n.Buffer,i=e,o=t,l=k();return u=function(){return h((function t(){s(this,t),this.algorithm=""}),[{key:"setAlgorithm",value:function(t){i(!l.isEmpty(t),"Algorithm cannot be set empty: ".concat(t)),this.algorithm=t}},{key:"KDF",value:function(t,e,n){for(var i=r.from(t,"utf-8"),s=r.concat([i,e]),h=0;h<n;h++)s=o.createHash("md5").update(s).digest();return s}},{key:"getKeyIV",value:function(t,e,n){var i=this.KDF(t,e,n);return[r.from(i,"binary").slice(0,8),r.from(i,"binary").slice(8,16)]}},{key:"encrypt",value:function(t,e,n,i){var s=this.getKeyIV(e,n,i),h=o.createCipheriv("des",s[0],s[1]),l=[];l.push(h.update(t,"utf-8","hex")),l.push(h.final("hex"));var a=r.from(l.join(""),"hex"),u=r.alloc(a.length+n.length);return n.copy(u,0,0,n.length),a.copy(u,n.length,0,a.length),u.toString("base64")}},{key:"decrypt",value:function(t,e,n){var i=r.from(t,"base64"),s=[],h=8<i.length?8:i.length,l=8<i.length?8:i.length,a=8<i.length?i.length-8:0,u=r.alloc(h),f=r.alloc(a);i.copy(u,0,0,h),i.copy(f,0,l,i.length);var c=this.getKeyIV(e,u,n),p=o.createDecipheriv("des",c[0],c[1]);return s.push(p.update(f)),s.push(p.final()),s.join("")}}])}()}(),a=k(),c=T(),p=function(){return h((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s(this,t),this._encryptor=new l,this._encryptor.setAlgorithm("PBEWithMD5AndDES"),this.salt=e.salt||r.randomBytes(8),this.iterations=e.iterations||1e3,this.password=""}),[{key:"getCacheKey",value:function(t){return"".concat(this.salt,"_").concat(this.iterations,"_").concat(this.password,"_").concat(t)}},{key:"setPassword",value:function(t){i(!a.isEmpty(a),"Password cannot be set empty"),this.password=t}},{key:"encrypt",value:function(t){return a.isEmpty(t)?null:this._encryptor.encrypt(t,this.password,this.salt,this.iterations)}},{key:"decrypt",value:function(t){if(a.isEmpty(t))return null;var e=this.getCacheKey(t);if(c.has(e))return c.get(e);var n=this._encryptor.decrypt(t,this.password,this.iterations);return c.set(e,n),n}},{key:"decryptConfig",value:function(t){if(a.isType("Object",t))for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];if(a.isType("Object",n))this.decryptConfig(n);else if(a.isType("String",n)){if(0===n.indexOf("ENC(")&&n.lastIndexOf(")")===n.length-1){var r=n.substring(4,n.length-1);t[e]=this.decrypt(r)}}else{if(!a.isType("Array",n))continue;var i,s=o(n);try{for(s.s();!(i=s.n()).done;){var h=i.value;a.isType("Object",h)&&this.decryptConfig(h)}}catch(t){s.e(t)}finally{s.f()}}}}}])}();return b=p}var C=r(E?A:(E=1,A=j()));module.exports=C;
